# Esquire Disassembly

This repository contains a living disassembly and annotation of the Esquire 9.04 scheduler, built for the Amiga platform. The goal is to document system behavior, preserve historical software, and enable small targeted fixes through commented assembly.

## Repository Layout
- `src/ESQ.asm` – Root include that pulls in every module. Use it as the entry point for builds.
- `src/modules/` – Feature modules (`gcommand.s`, `kybd.s`, `diskio2.s`, etc.) where we replace legacy `LAB_xxxx` labels with descriptive aliases.
- `src/data/` – Display tables, highlight presets, string resources, and lookup maps shared across modules.
- `src/subroutines/` and `src/interrupts/` – Common helpers and interrupt handlers referenced from multiple modules.
- `src/decomp/` – Experimental C decomp/cleanup helpers (reference-only, not part of the build).
- `assets/` – External requirements: Workbench ROM in `kickstart/` and the extracted HDD image in `disks/prevue/`.
- `build/` – Disposable build output regenerated by the scripts.
- `build.sh`, `test-hash.sh` – Helper scripts for assembling and verifying the image with the vasm toolchain.

## Pre-Requisites
- Place the Amiga Workbench 2.04 ROM at `assets/kickstart/v2.04.rom`.
- Download and extract the [Esquire 9.04 HDD image](https://park-city.club/~frix/prevue/Prevue.zip) into `assets/disks/prevue/`.
- Install [vasm](https://sun.hasenbraten.de/vasm/) (m68k, `mot` syntax) and update any hard-coded paths in the scripts to match your setup.
- Optional: Install the [Amiga Assembly](https://marketplace.visualstudio.com/items?itemName=prb28.amiga-assembly) VS Code extension for improved syntax support.

## Build & Verify
1. Ensure the vasm 68k binaries are installed and update their paths inside `build.sh` and `test-hash.sh` if your setup differs.
2. Make the helper scripts executable: `chmod +x build.sh test-hash.sh`.
3. Assemble the project with `./build.sh`. By default this writes `ESQ` to `~/Downloads/Prevue/`; edit the script to change the destination.
4. Confirm determinism with `./test-hash.sh`. A matching build prints `6bd4760d1cf0706297ef169461ed0d7b7f0b079110a78e34d89223499e7c2fa2` as the SHA-256 digest.

For targeted experiments you can run vasm directly, for example:
```bash
~/Downloads/vasm/vasmm68k_mot -Fhunkexe -linedebug -o build/ESQ src/ESQ.asm
```
Keep any generated binaries out of version control.

## Development Workflow
- When you rename a label, keep the original `LAB_xxxx` symbol in place and add the new alias directly above it. This preserves binary parity while growing readable names.
- Record noteworthy alias work and outstanding anonymous labels in [`AGENTS.md`](AGENTS.md) so future passes know where to continue.
- Update adjacent data tables (e.g., entries in `src/data/wdisp.s`) whenever you adjust presets or highlight behavior inside `src/modules/gcommand.s`.
- Re-run `./test-hash.sh` after each significant change; treat hash deltas as regressions unless intentionally diverging.

## Contributor Guide
If you plan to extend or annotate the disassembly, read the contributor guidelines in [`AGENTS.md`](AGENTS.md) for module organization, coding style, testing expectations, and review workflow.
